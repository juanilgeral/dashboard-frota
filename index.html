<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Completo - Todas as Opera√ß√µes</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1a237e;
            --secondary: #283593;
            --success: #2e7d32;
            --warning: #f57c00;
            --danger: #c62828;
            --info: #0277bd;
            --light: #f5f5f5;
            --dark: #212121;
            
            /* Cores das opera√ß√µes */
            --ls-color: #c62828; /* Vermelho */
            --ht-color: #2e7d32; /* Verde */
            --tl-color: #4caf50; /* Verde claro */
            --cv-color: #ff9800; /* Amarelo */
            --nl-color: #e57373; /* Vermelho claro */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', 'Segoe UI', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1920px;
            margin: 0 auto;
        }

        /* HEADER */
        .header {
            background: white;
            border-radius: 12px;
            padding: 20px 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 30px;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            font-size: 2.8rem;
            color: #1a237e;
        }

        .logo h1 {
            color: #1a237e;
            font-size: 1.8rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .logo-subtitle {
            color: #666;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .date-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .date-btn {
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s;
            color: #424242;
        }

        .date-btn:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
        }

        .date-btn.active {
            background: #1a237e;
            color: white;
            border-color: #1a237e;
            box-shadow: 0 4px 12px rgba(26, 35, 126, 0.3);
        }

        #currentDateDisplay {
            font-weight: 700;
            color: #1a237e;
            font-size: 1.3rem;
            text-align: center;
            min-width: 280px;
        }

        .status-badge {
            background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);
            color: white;
            padding: 10px 25px;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        /* LEGENDA DAS OPERA√á√ïES */
        .operacoes-legend {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .legend-title {
            color: #1a237e;
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 15px;
            background: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid;
            transition: all 0.3s;
        }

        .legend-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .legend-badge {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-weight: 800;
            font-size: 1.1rem;
            color: white !important;
            flex-shrink: 0;
        }

        .legend-badge.LS { background: var(--ls-color); }
        .legend-badge.HT { background: var(--ht-color); }
        .legend-badge.TL { background: var(--tl-color); }
        .legend-badge.CV { background: var(--cv-color); }
        .legend-badge.NL { background: var(--nl-color); }

        .legend-info {
            flex: 1;
        }

        .legend-sigla {
            font-weight: 800;
            font-size: 1.1rem;
            margin-bottom: 2px;
        }

        .legend-sigla.LS { color: var(--ls-color); }
        .legend-sigla.HT { color: var(--ht-color); }
        .legend-sigla.TL { color: var(--tl-color); }
        .legend-sigla.CV { color: var(--cv-color); }
        .legend-sigla.NL { color: var(--nl-color); }

        .legend-nome {
            font-size: 0.9rem;
            color: #666;
            font-weight: 600;
        }

        /* OPERA√á√ïES SUMMARY */
        .day-operations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .day-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }

        .day-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .day-date {
            font-weight: 700;
            color: #1a237e;
            font-size: 1.2rem;
        }

        .day-count {
            background: #1a237e;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .operations-list {
            display: grid;
            gap: 12px;
        }

        .op-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #f9f9f9;
            border-radius: 8px;
            transition: all 0.2s;
            border-left: 4px solid;
        }

        .op-item:hover {
            background: #f0f0f0;
            transform: translateX(5px);
        }

        .op-badge {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-weight: 800;
            font-size: 1.1rem;
            margin-right: 15px;
            flex-shrink: 0;
            color: white !important;
        }

        .op-badge.LS { 
            background: var(--ls-color); 
            border: 2px solid #b71c1c;
        }
        .op-badge.HT { 
            background: var(--ht-color);
            border: 2px solid #1b5e20;
        }
        .op-badge.TL { 
            background: var(--tl-color);
            border: 2px solid #388e3c;
        }
        .op-badge.CV { 
            background: var(--cv-color);
            border: 2px solid #f57c00;
        }
        .op-badge.NL { 
            background: var(--nl-color);
            border: 2px solid #d32f2f;
        }

        .op-info {
            flex: 1;
        }

        .op-main {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .op-vehicles {
            font-size: 0.85rem;
            color: #666;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .op-item.LS { border-left-color: var(--ls-color); }
        .op-item.HT { border-left-color: var(--ht-color); }
        .op-item.TL { border-left-color: var(--tl-color); }
        .op-item.CV { border-left-color: var(--cv-color); }
        .op-item.NL { border-left-color: var(--nl-color); }

        /* LAYOUT DE DUAS COLUNAS */
        .two-columns-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        /* CONTROLE DI√ÅRIO DA FROTA */
        .controle-diario-card {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            color: white;
            position: relative;
            overflow: hidden;
            height: 100%;
        }

        .controle-diario-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #4caf50, #ff9800, #c62828);
            border-radius: 12px 12px 0 0;
        }

        .controle-diario-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
            z-index: 2;
        }

        .controle-diario-titulo {
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .controle-diario-titulo span {
            font-size: 2rem;
        }

        .controle-diario-data {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .controle-diario-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            position: relative;
            z-index: 2;
        }

        .controle-stat-item {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s;
        }

        .controle-stat-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .controle-stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .controle-stat-value {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .controle-stat-sub {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        /* ESTILOS ESPEC√çFICOS DO CONTROLE DI√ÅRIO */
        .controle-operations-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .controle-operations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .controle-op-item {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .controle-op-badge {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-weight: 800;
            font-size: 1rem;
            color: white;
            flex-shrink: 0;
        }

        .controle-op-info {
            flex: 1;
        }

        .controle-op-sigla {
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 2px;
        }

        .controle-op-count {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        /* RELA√á√ÉO VE√çCULOS/MOTORISTAS */
        .relacao-veiculos-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            position: relative;
            height: 100%;
        }

        .relacao-veiculos-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #1a237e, #283593, #3949ab);
            border-radius: 12px 12px 0 0;
        }

        .relacao-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .relacao-titulo {
            color: #1a237e;
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .relacao-titulo span {
            font-size: 2rem;
        }

        .relacao-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .relacao-btn {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .relacao-btn:hover {
            background: linear-gradient(135deg, #283593 0%, #3949ab 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 35, 126, 0.3);
        }

        .relacao-btn.warning {
            background: linear-gradient(135deg, #ff9800 0%, #ffb74d 100%);
        }

        .relacao-btn.warning:hover {
            background: linear-gradient(135deg, #f57c00 0%, #ff9800 100%);
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
        }

        .relacao-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .relacao-section {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e0e0e0;
        }

        .relacao-section-title {
            color: #1a237e;
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .relacao-list {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .relacao-list::-webkit-scrollbar {
            width: 6px;
        }

        .relacao-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .relacao-list::-webkit-scrollbar-thumb {
            background: #c5c5c5;
            border-radius: 10px;
        }

        .relacao-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 6px;
            margin-bottom: 8px;
            border-left: 4px solid #1a237e;
            transition: all 0.2s;
        }

        .relacao-item:hover {
            background: #f0f0f0;
            transform: translateX(3px);
        }

        .relacao-nome {
            font-weight: 600;
            color: #424242;
            flex: 1;
        }

        .relacao-count {
            background: #1a237e;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-weight: 700;
            font-size: 0.9rem;
            min-width: 50px;
            text-align: center;
        }

        .relacao-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        .relacao-summary-item {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            border-radius: 8px;
            color: white;
        }

        .relacao-summary-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .relacao-summary-value {
            font-size: 2rem;
            font-weight: 800;
        }

        /* MODAL DE ATUALIZA√á√ÉO */
        .update-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .update-modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .update-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .update-modal-title {
            color: #1a237e;
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #666;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .close-btn:hover {
            background: #f5f5f5;
            color: #c62828;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            color: #424242;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #1a237e;
            box-shadow: 0 0 0 3px rgba(26, 35, 126, 0.1);
        }

        .form-text {
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
            margin-bottom: 15px;
        }

        .submit-btn {
            background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .submit-btn:hover {
            background: linear-gradient(135deg, #1b5e20 0%, #388e3c 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.3);
        }

        /* DASHBOARD LAYOUT */
        .dashboard-main {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        /* TABELA PRINCIPAL */
        .table-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            min-height: 700px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-title {
            color: #1a237e;
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-title-icon {
            font-size: 1.8rem;
        }

        .filters-row {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 10px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            font-weight: 600;
            color: #424242;
            cursor: pointer;
            min-width: 180px;
            font-size: 0.95rem;
        }

        .filter-select:focus {
            outline: none;
            border-color: #1a237e;
        }

        .table-container {
            border-radius: 8px;
            border: 1px solid #f0f0f0;
            overflow-y: visible;
            overflow-x: auto;
            max-height: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1400px;
        }

        th {
            background: #f5f5f5;
            padding: 18px 20px;
            text-align: left;
            color: #424242;
            font-weight: 700;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #e0e0e0;
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            padding: 16px 20px;
            border-bottom: 1px solid #f0f0f0;
            vertical-align: middle;
            font-size: 0.95rem;
        }

        tbody tr {
            transition: background 0.2s;
        }

        tbody tr:hover {
            background: #f9f9f9;
        }

        tbody tr.finalizado {
            background: #f1f8e9;
        }

        tbody tr.em-rota {
            background: #e3f2fd;
        }

        tbody tr.pendente {
            background: #fffde7;
        }

        tbody tr.sem-destino {
            background: #f5f5f5;
            opacity: 0.7;
        }

        tbody tr.sem-destino:hover {
            background: #eeeeee;
        }

        tbody tr.veiculo-finalizado {
            background: #fff8e1 !important;
        }

        tbody tr.veiculo-finalizado:hover {
            background: #ffecb3 !important;
        }

        td .op-cell {
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 800;
            font-size: 1rem;
            display: inline-block;
            text-align: center;
            min-width: 50px;
            color: white !important;
        }

        .op-cell.LS { background: var(--ls-color); }
        .op-cell.HT { background: var(--ht-color); }
        .op-cell.TL { background: var(--tl-color); }
        .op-cell.CV { background: var(--cv-color); }
        .op-cell.NL { background: var(--nl-color); }

        .status-indicator {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-finalizado {
            background: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #c8e6c9;
        }

        .status-em-rota {
            background: #e3f2fd;
            color: #1565c0;
            border: 2px solid #bbdefb;
        }

        .status-pendente {
            background: #fff8e1;
            color: #ff8f00;
            border: 2px solid #ffecb3;
        }

        .status-sem-destino {
            background: #f5f5f5;
            color: #757575;
            border: 2px solid #e0e0e0;
        }

        .finalizar-btn {
            padding: 8px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .finalizar-btn:not(.finalized) {
            background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.3);
        }

        .finalizar-btn:not(.finalized):hover {
            background: linear-gradient(135deg, #1b5e20 0%, #388e3c 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(46, 125, 50, 0.4);
        }

        .finalizar-btn.finalized {
            background: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #c8e6c9;
            cursor: default;
        }

        .finalizar-btn.finalized::before {
            content: "‚úì";
            font-weight: bold;
            font-size: 1.1rem;
        }

        .finalizar-btn.sem-destino {
            background: #e0e0e0;
            color: #757575;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .trip-badge {
            background: #ff9800;
            color: white;
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 12px;
            font-weight: 700;
            margin-left: 6px;
        }

        /* ESTAT√çSTICAS DE ROTA */
        .rota-stats {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-top: 25px;
        }

        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .stats-title {
            color: #1a237e;
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .export-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .export-btn {
            background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .export-btn:hover {
            background: linear-gradient(135deg, #1b5e20 0%, #388e3c 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.3);
        }

        .copy-btn {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            background: linear-gradient(135deg, #283593 0%, #3949ab 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 35, 126, 0.3);
        }

        .rota-card {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #1a237e;
        }

        .rota-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .rota-titulo {
            font-weight: 700;
            color: #1a237e;
            font-size: 1.1rem;
        }

        .rota-metricas {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
            color: #666;
        }

        .rota-veiculos {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #e0e0e0;
        }

        /* MODAL DE EXPORTA√á√ÉO */
        .export-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .export-modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .export-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .export-modal-title {
            color: #1a237e;
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #666;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .close-btn:hover {
            background: #f5f5f5;
            color: #c62828;
        }

        .export-options {
            margin-bottom: 25px;
        }

        .export-option {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #1a237e;
        }

        .export-option h3 {
            color: #1a237e;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .export-option p {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.95rem;
        }

        .export-textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.4;
            resize: vertical;
            margin-bottom: 15px;
        }

        .export-textarea:focus {
            outline: none;
            border-color: #1a237e;
        }

        .export-instructions {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.9rem;
            color: #666;
        }

        .export-instructions h4 {
            color: #1a237e;
            margin-bottom: 10px;
        }

        .export-instructions ul {
            list-style: none;
            padding-left: 0;
        }

        .export-instructions li {
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .export-instructions li::before {
            content: "‚Ä¢";
            color: #1a237e;
            position: absolute;
            left: 0;
        }

        /* UPLOAD SECTION */
        .upload-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-top: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .upload-title {
            color: #1a237e;
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .upload-box {
            border: 3px dashed #e0e0e0;
            border-radius: 12px;
            padding: 50px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 25px;
        }

        .upload-box:hover {
            border-color: #1a237e;
            background: #f5f5f5;
        }

        .upload-icon {
            font-size: 4rem;
            color: #1a237e;
            margin-bottom: 20px;
        }

        .upload-controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .upload-btn {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.95rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            flex: 1;
            justify-content: center;
            min-width: 200px;
        }

        .upload-btn:hover {
            background: linear-gradient(135deg, #283593 0%, #3949ab 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 35, 126, 0.3);
        }

        .upload-btn.danger {
            background: linear-gradient(135deg, #c62828 0%, #d32f2f 100%);
        }

        .upload-btn.danger:hover {
            background: linear-gradient(135deg, #b71c1c 0%, #c62828 100%);
            box-shadow: 0 4px 12px rgba(198, 40, 40, 0.3);
        }

        .upload-btn.warning {
            background: linear-gradient(135deg, #ff9800 0%, #ffb74d 100%);
        }

        .upload-btn.warning:hover {
            background: linear-gradient(135deg, #f57c00 0%, #ff9800 100%);
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
        }

        .upload-btn.success {
            background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);
        }

        .upload-btn.success:hover {
            background: linear-gradient(135deg, #1b5e20 0%, #388e3c 100%);
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.3);
        }

        .upload-instructions {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .instructions-title {
            color: #1a237e;
            font-weight: 700;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .instructions-list {
            list-style: none;
            padding-left: 0;
        }

        .instructions-list li {
            margin-bottom: 10px;
            padding-left: 25px;
            position: relative;
            color: #666;
        }

        .instructions-list li::before {
            content: "‚Ä¢";
            color: #1a237e;
            font-size: 1.5rem;
            position: absolute;
            left: 0;
            top: -5px;
        }

        /* PASSWORD MODAL */
        .password-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .password-modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .password-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .password-modal-title {
            color: #1a237e;
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .password-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 15px;
            font-family: monospace;
        }

        .password-input:focus {
            outline: none;
            border-color: #1a237e;
            box-shadow: 0 0 0 3px rgba(26, 35, 126, 0.1);
        }

        .password-error {
            color: #c62828;
            font-size: 0.9rem;
            margin-bottom: 15px;
            text-align: center;
            display: none;
        }

        .password-btn {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }

        .password-btn:hover {
            background: linear-gradient(135deg, #283593 0%, #3949ab 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 35, 126, 0.3);
        }

        /* LOADING */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none;
        }

        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #1a237e;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* FOOTER */
        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            padding: 20px;
            font-size: 0.95rem;
            opacity: 0.9;
        }

        /* RESPONSIVE */
        @media (max-width: 1200px) {
            .header {
                grid-template-columns: 1fr;
                gap: 20px;
                text-align: center;
            }
            
            .date-controls {
                justify-content: center;
            }
            
            #currentDateDisplay {
                min-width: auto;
            }
            
            .legend-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
            
            .stats-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .export-controls {
                width: 100%;
                justify-content: flex-start;
            }
            
            .relacao-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .two-columns-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            .day-operations {
                grid-template-columns: 1fr;
            }
            
            .filters-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-select {
                width: 100%;
            }
            
            .upload-box {
                padding: 30px 20px;
            }
            
            .legend-grid {
                grid-template-columns: 1fr;
            }
            
            .controle-diario-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .controle-operations-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .controle-diario-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .export-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .export-btn, .copy-btn {
                width: 100%;
                justify-content: center;
            }
            
            .upload-controls {
                flex-direction: column;
            }
            
            .upload-btn {
                width: 100%;
            }
            
            .relacao-controls {
                flex-direction: column;
                width: 100%;
            }
            
            .relacao-btn {
                width: 100%;
                justify-content: center;
            }
            
            .relacao-summary {
                grid-template-columns: 1fr;
            }
            
            .two-columns-layout {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .controle-diario-stats {
                grid-template-columns: 1fr;
            }
            
            .controle-operations-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">üöõ</div>
                <div>
                    <h1>Sistema de Controle de Frota</h1>
                    <div class="logo-subtitle">Todas as opera√ß√µes ‚Ä¢ Controle manual ‚Ä¢ Dados completos</div>
                </div>
            </div>
            
            <div class="date-controls">
                <button class="date-btn active" onclick="loadDate('today')">HOJE</button>
                <button class="date-btn" onclick="loadDate('yesterday')">ONTEM</button>
                <button class="date-btn" onclick="loadDate('all')">TODOS</button>
                <div id="currentDateDisplay">Carregando data...</div>
            </div>
            
            <div class="status-badge">
                <span>üìä</span> TODAS OPERA√á√ïES
            </div>
        </div>

        <!-- LEGENDA DAS OPERA√á√ïES -->
        <div class="operacoes-legend">
            <div class="legend-title">
                <span>üéØ</span>
                Legenda das Opera√ß√µes
            </div>
            <div class="legend-grid">
                <div class="legend-item LS">
                    <div class="legend-badge LS">LS</div>
                    <div class="legend-info">
                        <div class="legend-sigla LS">LS</div>
                        <div class="legend-nome">Lasa</div>
                    </div>
                </div>
                <div class="legend-item HT">
                    <div class="legend-badge HT">HT</div>
                    <div class="legend-info">
                        <div class="legend-sigla HT">HT</div>
                        <div class="legend-nome">Hortifruti</div>
                    </div>
                </div>
                <div class="legend-item TL">
                    <div class="legend-badge TL">TL</div>
                    <div class="legend-info">
                        <div class="legend-sigla TL">TL</div>
                        <div class="legend-nome">Tele Rio</div>
                    </div>
                </div>
                <div class="legend-item CV">
                    <div class="legend-badge CV">CV</div>
                    <div class="legend-info">
                        <div class="legend-sigla CV">CV</div>
                        <div class="legend-nome">Casa & V√≠deo</div>
                    </div>
                </div>
                <div class="legend-item NL">
                    <div class="legend-badge NL">NL</div>
                    <div class="legend-info">
                        <div class="legend-sigla NL">NL</div>
                        <div class="legend-nome">Nalin</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RESUMO DOS √öLTIMOS 3 DIAS -->
        <div class="day-operations" id="last3DaysSummary">
            <!-- Carregado dinamicamente -->
        </div>

        <!-- LAYOUT DE DUAS COLUNAS -->
        <div class="two-columns-layout">
            <!-- CONTROLE DI√ÅRIO DA FROTA -->
            <div class="controle-diario-card" id="controleDiario">
                <!-- Carregado dinamicamente -->
            </div>

            <!-- RELA√á√ÉO VE√çCULOS/MOTORISTAS -->
            <div class="relacao-veiculos-card" id="relacaoVeiculosCard">
                <div class="relacao-header">
                    <div class="relacao-titulo">
                        <span>üöö</span>
                        Rela√ß√£o Ve√≠culos/Motoristas
                    </div>
                    <div class="relacao-controls">
                        <button class="relacao-btn" onclick="openUpdateVeiculosModal()">
                            <span>üìù</span>
                            Atualizar Ve√≠culos
                        </button>
                        <button class="relacao-btn warning" onclick="openUpdateMotoristasModal()">
                            <span>üë∑</span>
                            Atualizar Motoristas
                        </button>
                    </div>
                </div>
                
                <div class="relacao-grid">
                    <div class="relacao-section">
                        <div class="relacao-section-title">
                            <span>üöõ</span>
                            Ve√≠culos em Opera√ß√£o
                            <span style="margin-left: auto; font-size: 0.9rem; color: #666;" id="totalVeiculosInfo">Total: 0</span>
                        </div>
                        <div class="relacao-list" id="veiculosList">
                            <!-- Carregado dinamicamente -->
                        </div>
                    </div>
                    
                    <div class="relacao-section">
                        <div class="relacao-section-title">
                            <span>üë∑</span>
                            Motoristas Ativos
                            <span style="margin-left: auto; font-size: 0.9rem; color: #666;" id="totalMotoristasInfo">Total: 0</span>
                        </div>
                        <div class="relacao-list" id="motoristasList">
                            <!-- Carregado dinamicamente -->
                        </div>
                    </div>
                </div>
                
                <div class="relacao-summary">
                    <div class="relacao-summary-item">
                        <div class="relacao-summary-label">Total de Ve√≠culos</div>
                        <div class="relacao-summary-value" id="totalVeiculos">0</div>
                    </div>
                    <div class="relacao-summary-item">
                        <div class="relacao-summary-label">Total de Motoristas</div>
                        <div class="relacao-summary-value" id="totalMotoristas">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- DASHBOARD PRINCIPAL -->
        <div class="dashboard-main">
            <div class="table-card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="card-title-icon">üìã</span>
                        Todas as Viagens
                        <span id="tripCount" style="font-size: 0.95rem; color: #666; font-weight: normal;">(0 viagens com destino v√°lido)</span>
                    </div>
                    <div class="filters-row">
                        <select class="filter-select" id="dateFilter" onchange="filterTable()">
                            <option value="all">Todas as Datas</option>
                            <!-- Datas carregadas dinamicamente -->
                        </select>
                        <select class="filter-select" id="opFilter" onchange="filterTable()">
                            <option value="all">Todas Opera√ß√µes</option>
                            <option value="LS">LS</option>
                            <option value="HT">HT</option>
                            <option value="TL">TL</option>
                            <option value="CV">CV</option>
                            <option value="NL">NL</option>
                        </select>
                        <select class="filter-select" id="statusFilter" onchange="filterTable()">
                            <option value="all">Todos Status</option>
                            <option value="com-destino">Com Destino V√°lido</option>
                            <option value="sem-destino">Sem Destino V√°lido</option>
                            <option value="pendente">Pendentes</option>
                            <option value="em-rota">Em Rota</option>
                            <option value="finalizado">Finalizados</option>
                        </select>
                        <select class="filter-select" id="destinoFilter" onchange="filterTable()">
                            <option value="all">Todos (com/sem destino)</option>
                            <option value="com-destino" selected>Apenas com Destino V√°lido</option>
                            <option value="sem-destino">Apenas sem Destino V√°lido</option>
                        </select>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="mainTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>DATA</th>
                                <th>OP</th>
                                <th>Ve√≠culo</th>
                                <th>Motorista</th>
                                <th>Ponto ON</th>
                                <th>Sa√≠da CD</th>
                                <th>Destino</th>
                                <th>Ponto OFF</th>
                                <th>Status</th>
                                <th>Controle</th>
                                <th>Viagem</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- Dados carregados aqui -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ESTAT√çSTICAS DE ROTAS FREQUENTES -->
        <div class="rota-stats">
            <div class="stats-header">
                <div class="stats-title">
                    <span>üìà</span>
                    Estat√≠sticas de Rotas Frequentes (Apenas viagens com destino v√°lido)
                </div>
                <div class="export-controls">
                    <button class="export-btn" onclick="openExportModal()">
                        üìä Exportar Dados
                    </button>
                    <button class="copy-btn" onclick="copyRoutesToClipboard()">
                        üìã Copiar para Planilha
                    </button>
                </div>
            </div>
            <div id="rotaFrequenteContent">
                <!-- Rotas frequentes carregadas aqui -->
            </div>
        </div>

        <!-- UPLOAD E CONTROLE -->
        <div class="upload-section">
            <div class="upload-title">
                <span>üì§</span>
                Atualiza√ß√£o de Dados Completa
            </div>
            
            <div class="upload-box" onclick="requestPassword()">
                <div class="upload-icon">üìÅ</div>
                <p style="font-size: 1.2rem; margin-bottom: 10px; color: #1a237e; font-weight: 700;">
                    Importar Planilha Completa
                </p>
                <p style="color: #666;">
                    Clique para importar todos os dados da sua planilha (Somente Supervis√£o)
                </p>
            </div>
            
            <input type="file" id="fileInput" accept=".csv" style="display: none;" onchange="handleFileUpload(event)">
            
            <!-- BOT√ïES DE CONTROLE ADICIONAIS -->
            <div class="upload-controls">
                <button class="upload-btn danger" onclick="confirmClearData()">
                    üóëÔ∏è Limpar Todos os Dados
                </button>
            </div>
            
            <div class="upload-instructions">
                <div class="instructions-title">üìã Como funciona:</div>
                <ul class="instructions-list">
                    <li><strong>Todos os dados</strong> da planilha s√£o processados e atualizados</li>
                    <li><strong>Viagens consideradas:</strong> Apenas registros com campo Destino v√°lido</li>
                    <li><strong>Destinos inv√°lidos:</strong> COBRAN√áA 50%, Garagem X..., ... X Garagem, campos vazios</li>
                    <li><strong>Controle manual</strong> de finaliza√ß√£o preservado</li>
                    <li><strong>√öltimos 3 dias</strong> mostrados no resumo acima</li>
                    <li><strong>Senha de supervis√£o:</strong> @admin0768# (necess√°ria para importar dados)</li>
                    <li><strong>Rela√ß√£o Ve√≠culos/Motoristas:</strong> Atualize manualmente os totais</li>
                </ul>
            </div>
        </div>

        <!-- FOOTER -->
        <div class="footer">
            <p>Sistema Completo de Controle de Frota ‚Ä¢ Todas as opera√ß√µes ‚Ä¢ Apenas viagens com destino v√°lido</p>
            <p>Total de registros: <span id="totalRecords">0</span> ‚Ä¢ Viagens com destino v√°lido: <span id="totalViagensComDestino">0</span> ‚Ä¢ √öltima atualiza√ß√£o: <span id="lastUpdate">Carregando...</span></p>
        </div>
    </div>

    <!-- MODAL DE ATUALIZA√á√ÉO DE VE√çCULOS -->
    <div class="update-modal" id="updateVeiculosModal">
        <div class="update-modal-content">
            <div class="update-modal-header">
                <div class="update-modal-title">
                    <span>üöõ</span>
                    Atualizar Total de Ve√≠culos
                </div>
                <button class="close-btn" onclick="closeUpdateVeiculosModal()">√ó</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">Total de Ve√≠culos em Opera√ß√£o:</label>
                <input type="number" id="veiculosInput" class="form-input" min="0" max="100" placeholder="Ex: 25" value="0">
                <div class="form-text">Informe o n√∫mero total de ve√≠culos dispon√≠veis para opera√ß√£o.</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Distribui√ß√£o por Opera√ß√£o (opcional):</label>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 10px;">
                    <div>
                        <label style="font-size: 0.9rem; color: #666;">LS:</label>
                        <input type="number" id="veiculosLS" class="form-input" min="0" placeholder="0" style="font-size: 0.9rem;">
                    </div>
                    <div>
                        <label style="font-size: 0.9rem; color: #666;">HT:</label>
                        <input type="number" id="veiculosHT" class="form-input" min="0" placeholder="0" style="font-size: 0.9rem;">
                    </div>
                    <div>
                        <label style="font-size: 0.9rem; color: #666;">TL:</label>
                        <input type="number" id="veiculosTL" class="form-input" min="0" placeholder="0" style="font-size: 0.9rem;">
                    </div>
                    <div>
                        <label style="font-size: 0.9rem; color: #666;">CV:</label>
                        <input type="number" id="veiculosCV" class="form-input" min="0" placeholder="0" style="font-size: 0.9rem;">
                    </div>
                    <div>
                        <label style="font-size: 0.9rem; color: #666;">NL:</label>
                        <input type="number" id="veiculosNL" class="form-input" min="0" placeholder="0" style="font-size: 0.9rem;">
                    </div>
                </div>
                <div class="form-text">Preencha a distribui√ß√£o por opera√ß√£o para um controle mais detalhado.</div>
            </div>
            
            <button class="submit-btn" onclick="updateVeiculos()">
                <span>üíæ</span>
                Salvar Altera√ß√µes
            </button>
        </div>
    </div>

    <!-- MODAL DE ATUALIZA√á√ÉO DE MOTORISTAS -->
    <div class="update-modal" id="updateMotoristasModal">
        <div class="update-modal-content">
            <div class="update-modal-header">
                <div class="update-modal-title">
                    <span>üë∑</span>
                    Atualizar Total de Motoristas
                </div>
                <button class="close-btn" onclick="closeUpdateMotoristasModal()">√ó</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">Total de Motoristas Ativos:</label>
                <input type="number" id="motoristasInput" class="form-input" min="0" max="50" placeholder="Ex: 18" value="0">
                <div class="form-text">Informe o n√∫mero total de motoristas dispon√≠veis para opera√ß√£o.</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Adicionar Motoristas (opcional):</label>
                <textarea id="motoristasListInput" class="form-input" rows="4" placeholder="Digite os nomes dos motoristas, um por linha
Ex:
Jo√£o Silva
Maria Santos
Carlos Oliveira"></textarea>
                <div class="form-text">Adicione os nomes dos motoristas, um por linha. Os nomes ser√£o combinados com os j√° existentes.</div>
            </div>
            
            <button class="submit-btn" onclick="updateMotoristas()">
                <span>üíæ</span>
                Salvar Altera√ß√µes
            </button>
        </div>
    </div>

    <!-- MODAL DE SENHA -->
    <div class="password-modal" id="passwordModal">
        <div class="password-modal-content">
            <div class="password-modal-header">
                <div class="password-modal-title">
                    <span>üîí</span>
                    Autentica√ß√£o de Supervis√£o
                </div>
                <button class="close-btn" onclick="closePasswordModal()">√ó</button>
            </div>
            
            <p style="color: #666; margin-bottom: 20px; text-align: center;">
                Esta a√ß√£o requer autoriza√ß√£o de supervis√£o.<br>
                Digite a senha para continuar.
            </p>
            
            <input type="password" id="passwordInput" class="password-input" placeholder="Digite a senha de supervis√£o">
            
            <div class="password-error" id="passwordError">
                Senha incorreta. Tente novamente.
            </div>
            
            <button class="password-btn" onclick="verifyPassword()">
                <span>üîë</span>
                Verificar Senha
            </button>
        </div>
    </div>

    <!-- MODAL DE EXPORTA√á√ÉO -->
    <div class="export-modal" id="exportModal">
        <div class="export-modal-content">
            <div class="export-modal-header">
                <div class="export-modal-title">
                    <span>üìä</span>
                    Exportar Dados das Rotas Frequentes
                </div>
                <button class="close-btn" onclick="closeExportModal()">√ó</button>
            </div>
            
            <div class="export-options">
                <div class="export-option">
                    <h3>üìã Formato Excel/Planilha Google</h3>
                    <p>Cole os dados abaixo diretamente na primeira c√©lula (A1) de uma planilha Excel ou Google Sheets:</p>
                    <textarea class="export-textarea" id="exportExcelData" readonly></textarea>
                    <button class="copy-btn" onclick="copyExcelData()">
                        üìã Copiar Dados para Excel
                    </button>
                </div>
                
                <div class="export-option">
                    <h3>üìä Dados Detalhados (JSON)</h3>
                    <p>Dados completos em formato JSON para an√°lise avan√ßada:</p>
                    <textarea class="export-textarea" id="exportJsonData" readonly></textarea>
                    <button class="copy-btn" onclick="copyJsonData()">
                        üìã Copiar Dados JSON
                    </button>
                </div>
                
                <div class="export-instructions">
                    <h4>üìù Como usar os dados exportados:</h4>
                    <ul>
                        <li><strong>Excel:</strong> Cole na c√©lula A1, selecione "Dados" ‚Üí "Texto para Colunas" ‚Üí Delimitado ‚Üí V√≠rgula</li>
                        <li><strong>Google Sheets:</strong> Cole na c√©lula A1, selecione "Dados" ‚Üí "Dividir texto em colunas" ‚Üí V√≠rgula</li>
                        <li><strong>Data de exporta√ß√£o:</strong> Os dados incluem a data atual para refer√™ncia</li>
                        <li><strong>Filtros aplicados:</strong> Apenas viagens com destino v√°lido s√£o inclu√≠das</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- LOADING OVERLAY -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div style="font-size: 1.2rem; color: #1a237e; font-weight: 700;">Carregando todas as opera√ß√µes...</div>
    </div>

    <script>
        // ============================================
        // DADOS INICIAIS DA PLANILHA (SIMPLIFICADO)
        // ============================================
        const initialFrotaData = `DATA,DIA,OP,VEICULO,MOTORISTA,PONTO_ON_MOT.,PREVIS√ÉO_REFEI√á√ÉO,PONTO_OFF_MOTO.,PR√ìX_HORA_DISP,DESTINO,SA√çDA_VE√çCULO_CD
02/01/26,sex.,LS,064 LUV 9296,MARTINS,05:13:00,10:13:00,14:09:00,01:09:00,069 - CAXIAS / 774 - SHOP. CAXIAS,06:10:00
02/01/26,sex.,LS,065 KZQ 9648,JOEL,09:48:00,14:48:00,,,GARAGEM X LASA,10:14:00
02/01/26,sex.,LS,066 LUB 1400,JOEL,09:48:00,14:48:00,16:18:00,03:18:00,GARAGEM X LASA,14:19:00
02/01/26,sex.,LS,067 LUX 9063,C√âLIO,05:00:00,10:00:00,16:25:00,03:25:00,164 - SHOP. CARIOCA / 258 - SHOP. MADUREIRA,06:20:00
02/01/26,sex.,TL,108 LSM 7748,CLAUDINEI,06:30:00,11:30:00,17:20:00,04:20:00,GARAGEM X TELERIO (COBRAN√áA DEVIDA),06:45:00
02/01/26,sex.,TL,113 KXU 6988,NOGUEIRA,06:43:00,11:43:00,17:20:00,04:20:00,03 - CAMPO GRANDE(Pablo e Pablo Winicius),12:50:00
02/01/26,sex.,TL,116 LSQ 6092,ALEXANDRE,06:36:00,11:36:00,17:17:00,04:17:00,03 - CAMPO GRANDE (Jo√£o Vitor e Rafael),10:10:00
02/01/26,sex.,TL,117 KRR 2728,ANDERSON,05:44:00,10:44:00,,,GARAGEM X TELERIO,06:10:00
02/01/26,sex.,TL,117 KRR 2728,ANDERSON,05:44:00,10:44:00,17:20:00,04:20:00,09 - M√âIER ( Wesley e Gabriel),10:50:00
02/01/26,sex.,TL,118 LSQ 6093,EDILSON,06:47:00,11:47:00,17:20:00,04:20:00,COBRAN√áA 50%,06:50:00
02/01/26,sex.,HT,048 LSZ 0790,ROG√âRIO,03:00:00,08:00:00,11:20:00,22:20:00,MARACAN√É / CONDE DE BONFIM / CB 648 / TIJUCA / CONDE 99 / ILHA,05:30:00
02/01/26,sex.,HT,093 KVF 3715,WALMIR,03:19:00,08:19:00,12:38:00,23:38:00,BARRA BLUE / A5 / RECREIO / AMERICAS / ABELARDO BUENO / FREGUESIA,05:12:00
02/01/26,sex.,HT,122 DPF 7I23,VALDIR,03:00:00,08:00:00,14:05:00,01:05:00,ABRANTES / PRADO JUNIOR / SIQUEIRA CAMPOS / DIAS DA ROCHA / ADALBERTO / S√ÉO CONRADO / LEBLON / JARDIM BOT√ÇNICO,05:32:00
02/01/26,sex.,HT,125 OWO 2F73,NEVES,03:05:00,08:05:00,11:15:00,22:15:00,M. PARANA / REGI√ÉO OCE√ÇNICA / ITAIPU / SANTA ROSA,05:37:00
02/01/26,sex.,CV,124 ATI 4G85,ROSENDO,04:07:00,09:07:00,12:01:00,23:01:00,S√ÉO GON√áALO I - 374,04:47:00
02/01/26,sex.,CV,097 LRX 4831,GILMAR,13:25:00,18:25:00,19:30:00,06:30:00,SHOP MADUREIRA-255,13:30:00
02/01/26,sex.,CV,101 LRX 4832,LUIZ,13:00:00,18:00:00,19:00:00,06:00:00,NORTE SHOP-240,13:30:00
02/01/26,sex.,CV,105 KPU 7450,SERGIO SILVA,13:30:00,18:30:00,18:40:00,05:40:00,SHOP CAXIAS-327,13:30:00`;

        // ============================================
        // VARI√ÅVEIS GLOBAIS
        // ============================================
        let frotaData = [];
        let manualFinalizations = {};
        let allDates = [];
        let driverStatistics = {};
        let routeStatistics = {};
        let vehicleStatistics = {};
        
        // Dados de ve√≠culos e motoristas
        let veiculosData = {
            total: 0,
            distribuicao: {
                LS: 0,
                HT: 0,
                TL: 0,
                CV: 0,
                NL: 0
            }
        };
        
        let motoristasData = {
            total: 0,
            lista: []
        };
        
        // Senha de supervis√£o
        const SUPERVISOR_PASSWORD = "@admin0768#";

        // Mapeamento das opera√ß√µes
        const operacoesMap = {
            'LS': { nome: 'Lasa', cor: '#c62828' },
            'HT': { nome: 'Hortifruti', cor: '#2e7d32' },
            'TL': { nome: 'Tele Rio', cor: '#4caf50' },
            'CV': { nome: 'Casa & V√≠deo', cor: '#ff9800' },
            'NL': { nome: 'Nalin', cor: '#e57373' }
        };

        // ============================================
        // FUN√á√ïES PRINCIPAIS
        // ============================================

        // INICIALIZAR SISTEMA
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Dashboard inicializando...');
            initializeSystem();
        });

        function initializeSystem() {
            showLoading();
            
            try {
                // Atualizar data de exibi√ß√£o
                updateCurrentDateDisplay();
                
                // Carregar dados do localStorage
                loadDataFromStorage();
                
                // Carregar dados de ve√≠culos e motoristas
                loadVeiculosMotoristasData();
                
                // Carregar finaliza√ß√µes manuais
                loadManualFinalizations();
                
                // Aplicar finaliza√ß√µes manuais aos dados
                applyManualFinalizations();
                
                // Identificar viagens m√∫ltiplas
                identifyMultipleTrips();
                
                // Extrair todas as datas √∫nicas
                extractAllDates();
                
                // Calcular estat√≠sticas avan√ßadas
                calculateAdvancedStatistics();
                
                // Carregar interface
                loadLast3DaysSummary();
                loadControleDiario();
                updateDateFilterOptions();
                loadTableData();
                updateRotaFrequente();
                updateRelacaoVeiculosMotoristas();
                updateTimestamp();
                
                // Atualizar contadores
                updateCounters();
                
            } catch (error) {
                console.error('Erro ao inicializar:', error);
                showNotification('Erro ao carregar dados: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }

        // ATUALIZAR DATA DE EXIBI√á√ÉO ATUAL
        function updateCurrentDateDisplay() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            const dateString = now.toLocaleDateString('pt-BR', options);
            document.getElementById('currentDateDisplay').textContent = dateString;
        }

        // CARREGAR DADOS DO LOCALSTORAGE
        function loadDataFromStorage() {
            const savedData = localStorage.getItem('frotaCSVData');
            
            if (savedData) {
                processCSVData(savedData);
            } else {
                processCSVData(initialFrotaData);
            }
        }

        // CARREGAR DADOS DE VE√çCULOS E MOTORISTAS
        function loadVeiculosMotoristasData() {
            // Carregar ve√≠culos
            const savedVeiculos = localStorage.getItem('frotaVeiculosData');
            if (savedVeiculos) {
                try {
                    veiculosData = JSON.parse(savedVeiculos);
                } catch (e) {
                    veiculosData = {
                        total: 0,
                        distribuicao: {
                            LS: 0,
                            HT: 0,
                            TL: 0,
                            CV: 0,
                            NL: 0
                        }
                    };
                }
            }
            
            // Carregar motoristas
            const savedMotoristas = localStorage.getItem('frotaMotoristasData');
            if (savedMotoristas) {
                try {
                    motoristasData = JSON.parse(savedMotoristas);
                } catch (e) {
                    motoristasData = {
                        total: 0,
                        lista: []
                    };
                }
            }
        }

        // SALVAR DADOS DE VE√çCULOS E MOTORISTAS
        function saveVeiculosMotoristasData() {
            localStorage.setItem('frotaVeiculosData', JSON.stringify(veiculosData));
            localStorage.setItem('frotaMotoristasData', JSON.stringify(motoristasData));
        }

        // SALVAR DADOS NO LOCALSTORAGE
        function saveDataToStorage(csvData) {
            localStorage.setItem('frotaCSVData', csvData);
        }

        // FUN√á√ÉO PARA VERIFICAR SE √â UMA VIAGEM V√ÅLIDA (USANDO CSV REAL)
        function isViagemValidaReal(item) {
            const destino = item.DESTINO ? item.DESTINO.trim().toUpperCase() : '';
            
            if (!destino) return false;
            
            const destinosInvalidos = [
                destino.includes('COBRAN√áA'),
                destino.includes('COBRANCA'),
                destino.startsWith('GARAGEM X'),
                destino.includes(' X GARAGEM'),
                destino === '',
                destino === '-',
                destino === '--',
                destino.includes('RETORNOU CARREGADO'),
                destino.includes('SEM CONDI√á√ïES'),
                destino.includes('N√ÉO SAIU'),
                destino.includes('VE√çCULO N√ÉO'),
                destino.includes('TRANSBORDO'),
                destino.includes('REBOCOU'),
                destino.includes('TESTE'),
                destino.includes('MANUTEN√á√ÉO')
            ];
            
            return !destinosInvalidos.some(invalido => invalido === true);
        }

        // PROCESSAR DADOS DO CSV - VERS√ÉO CORRIGIDA PARA O CSV REAL
        function processCSVData(csvString) {
            console.log("Processando dados CSV...");
            
            const lines = csvString.split('\n').filter(line => line.trim() !== '');
            
            if (lines.length === 0) {
                throw new Error('Arquivo CSV vazio');
            }
            
            // Encontrar linha de cabe√ßalho
            let headerLine = '';
            let dataStartIndex = 0;
            
            for (let i = 0; i < Math.min(5, lines.length); i++) {
                const line = lines[i].toUpperCase();
                if (line.includes('DATA') && (line.includes('VEICULO') || line.includes('VE√çCULO'))) {
                    headerLine = lines[i];
                    dataStartIndex = i + 1;
                    break;
                }
            }
            
            // Se n√£o encontrou cabe√ßalho espec√≠fico, usa a primeira linha
            if (!headerLine) {
                headerLine = lines[0];
                dataStartIndex = 1;
            }
            
            const headers = headerLine.split(',').map(h => h.trim());
            frotaData = [];
            
            console.log('Cabe√ßalhos detectados:', headers);
            
            // Processar cada linha de dados
            for (let i = dataStartIndex; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line || line.split(',').length < 5) continue;
                
                const values = parseCSVLine(line);
                const item = {};
                
                // Mapear valores para cabe√ßalhos
                headers.forEach((header, index) => {
                    item[header] = values[index] ? values[index].trim() : '';
                });
                
                // Garantir que temos os campos necess√°rios
                if (!item.DATA) {
                    console.warn(`Linha ${i + 1} ignorada - sem data`);
                    continue;
                }
                
                // Normalizar nomes de campos
                if (!item.VEICULO && item['VE√çCULO']) item.VEICULO = item['VE√çCULO'];
                if (!item.MOTORISTA && item.Motorista) item.MOTORISTA = item.Motorista;
                if (!item.OP && item.Op) item.OP = item.Op;
                if (!item.DESTINO && item['DESTINO']) item.DESTINO = item['DESTINO'];
                
                // Determinar opera√ß√£o baseada no destino
                if (!item.OP || !operacoesMap[item.OP]) {
                    const destino = item.DESTINO || '';
                    if (destino.toUpperCase().includes('LASA')) item.OP = 'LS';
                    else if (destino.toUpperCase().includes('HORTIFRUTI')) item.OP = 'HT';
                    else if (destino.toUpperCase().includes('TELERIO') || destino.toUpperCase().includes('TELERIO')) item.OP = 'TL';
                    else if (destino.toUpperCase().includes('CASA & V√çDEO') || destino.toUpperCase().includes('CASA E VIDEO')) item.OP = 'CV';
                    else if (destino.toUpperCase().includes('NALIN')) item.OP = 'NL';
                    else item.OP = 'LS'; // Padr√£o
                }
                
                // Verificar se √© viagem v√°lida usando o campo DESTINO
                item.TEM_DESTINO = isViagemValidaReal(item);
                
                // Gerar ID √∫nico
                item.id = generateUniqueId(item);
                
                // Determinar status autom√°tico
                item.STATUS_AUTO = determineAutoStatus(item);
                item.STATUS_MANUAL = null;
                item.FINALIZADO_MANUALMENTE = false;
                
                // Formatar data para exibi√ß√£o
                item.DATA_DISPLAY = formatDateForDisplay(item.DATA);
                
                // Extrair n√∫mero da loja
                item.LOJA_NUMERO = item.TEM_DESTINO ? extractLojaNumber(item.DESTINO || '') : '';
                
                // Obter informa√ß√µes da opera√ß√£o
                item.OP_INFO = operacoesMap[item.OP] || { nome: item.OP, cor: '#666' };
                
                frotaData.push(item);
            }
            
            console.log(`Dados processados: ${frotaData.length} registros`);
            saveDataToStorage(csvString);
            
            // Ap√≥s processar, atualizar tudo
            updateAllAfterDataLoad();
        }

        // PARSE DE LINHA CSV
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current);
            return result.map(val => val.trim());
        }

        // GERAR ID √öNICO
        function generateUniqueId(item) {
            const baseId = `${item.DATA}_${item.OP}_${item.VEICULO}_${item.MOTORISTA}_${item['PONTO_ON_MOT.'] || ''}_${item.DESTINO || ''}`
                .replace(/\s+/g, '_')
                .replace(/[^a-zA-Z0-9_]/g, '');
            
            let hash = 0;
            for (let i = 0; i < baseId.length; i++) {
                const char = baseId.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            
            return `${baseId}_${Math.abs(hash)}`;
        }

        // DETERMINAR STATUS AUTOM√ÅTICO
        function determineAutoStatus(item) {
            if (item['PONTO_OFF_MOTO.'] && item['PONTO_OFF_MOTO.'].trim()) {
                return 'finalizado';
            } else if (item['SA√çDA_VE√çCULO_CD'] && item['SA√çDA_VE√çCULO_CD'].trim()) {
                return 'em-rota';
            } else {
                return 'pendente';
            }
        }

        // FORMATAR DATA PARA EXIBI√á√ÉO
        function formatDateForDisplay(dateStr) {
            if (!dateStr) return '';
            const [day, month, year] = dateStr.split('/');
            const date = new Date(`20${year}`, month - 1, day);
            return date.toLocaleDateString('pt-BR', { 
                weekday: 'long', 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric' 
            });
        }

        // EXTRAIR N√öMERO DA LOJA
        function extractLojaNumber(destino) {
            if (!destino) return '';
            const match = destino.match(/(\d+)/);
            return match ? match[0] : '';
        }

        // CARREGAR FINALIZA√á√ïES MANUAIS
        function loadManualFinalizations() {
            const saved = localStorage.getItem('frotaManualFinalizations');
            if (saved) {
                try {
                    manualFinalizations = JSON.parse(saved);
                } catch (e) {
                    manualFinalizations = {};
                }
            } else {
                manualFinalizations = {};
            }
        }

        // SALVAR FINALIZA√á√ïES MANUAIS
        function saveManualFinalizations() {
            localStorage.setItem('frotaManualFinalizations', JSON.stringify(manualFinalizations));
        }

        // APLICAR FINALIZA√á√ïES MANUAIS
        function applyManualFinalizations() {
            frotaData.forEach(item => {
                if (manualFinalizations[item.id]) {
                    item.STATUS_MANUAL = 'finalizado';
                    item.FINALIZADO_MANUALMENTE = true;
                } else {
                    item.STATUS_MANUAL = null;
                    item.FINALIZADO_MANUALMENTE = false;
                }
            });
        }

        // IDENTIFICAR VIAGENS M√öLTIPLAS
        function identifyMultipleTrips() {
            const tripsByVehicleDriverDate = {};
            
            const viagensComDestino = frotaData.filter(item => item.TEM_DESTINO);
            
            viagensComDestino.forEach(item => {
                const key = `${item.VEICULO}_${item.MOTORISTA}_${item.DATA}`;
                if (!tripsByVehicleDriverDate[key]) {
                    tripsByVehicleDriverDate[key] = [];
                }
                tripsByVehicleDriverDate[key].push(item);
            });
            
            frotaData.forEach(item => {
                item.VIAGEM_NUMERO = 1;
                item.TOTAL_VIAGENS = 1;
                item.VIAGEM_MULTIPLA = false;
            });
            
            Object.values(tripsByVehicleDriverDate).forEach(trips => {
                if (trips.length > 1) {
                    trips.forEach((trip, index) => {
                        trip.VIAGEM_NUMERO = index + 1;
                        trip.TOTAL_VIAGENS = trips.length;
                        trip.VIAGEM_MULTIPLA = true;
                    });
                }
            });
        }

        // EXTRAIR TODAS AS DATAS √öNICAS
        function extractAllDates() {
            const datesSet = new Set();
            
            const viagensComDestino = frotaData.filter(item => item.TEM_DESTINO);
            
            viagensComDestino.forEach(item => {
                if (item.DATA) {
                    datesSet.add(item.DATA);
                }
            });
            
            allDates = Array.from(datesSet).sort((a, b) => {
                const dateA = parseDate(a);
                const dateB = parseDate(b);
                return dateB - dateA;
            });
        }

        function parseDate(dateStr) {
            if (!dateStr) return null;
            const [day, month, year] = dateStr.split('/');
            return new Date(2000 + parseInt(year), parseInt(month) - 1, parseInt(day));
        }

        // ATUALIZAR TUDO AP√ìS CARREGAR DADOS
        function updateAllAfterDataLoad() {
            applyManualFinalizations();
            identifyMultipleTrips();
            extractAllDates();
            calculateAdvancedStatistics();
            loadLast3DaysSummary();
            loadControleDiario();
            updateDateFilterOptions();
            loadTableData();
            updateRotaFrequente();
            updateRelacaoVeiculosMotoristas();
            updateTimestamp();
            updateCounters();
        }

        // CALCULAR ESTAT√çSTICAS AVAN√áADAS
        function calculateAdvancedStatistics() {
            driverStatistics = {};
            routeStatistics = {};
            vehicleStatistics = {};
            
            const viagensComDestino = frotaData.filter(item => item.TEM_DESTINO);
            
            viagensComDestino.forEach(item => {
                const motorista = item.MOTORISTA;
                const veiculo = item.VEICULO;
                const rota = item.DESTINO ? item.DESTINO.substring(0, 50) : 'N√£o especificada';
                const lojaNumero = item.LOJA_NUMERO;
                
                // Estat√≠sticas por motorista
                if (motorista) {
                    if (!driverStatistics[motorista]) {
                        driverStatistics[motorista] = {
                            nome: motorista,
                            totalViagens: 0,
                            totalDias: new Set(),
                            rotasFrequentes: {},
                            veiculosUtilizados: new Set(),
                            viagensConcluidas: 0,
                            operacoes: {}
                        };
                    }
                    
                    const stats = driverStatistics[motorista];
                    stats.totalViagens++;
                    stats.totalDias.add(item.DATA);
                    stats.veiculosUtilizados.add(veiculo);
                    
                    if (!stats.operacoes[item.OP]) {
                        stats.operacoes[item.OP] = 0;
                    }
                    stats.operacoes[item.OP]++;
                    
                    if (item.STATUS_AUTO === 'finalizado' || item.STATUS_MANUAL === 'finalizado') {
                        stats.viagensConcluidas++;
                    }
                    
                    if (rota && rota !== 'N√£o especificada') {
                        if (!stats.rotasFrequentes[rota]) {
                            stats.rotasFrequentes[rota] = 0;
                        }
                        stats.rotasFrequentes[rota]++;
                    }
                }
                
                // Estat√≠sticas por rota
                if (rota && rota !== 'N√£o especificada') {
                    if (!routeStatistics[rota]) {
                        routeStatistics[rota] = {
                            nome: rota,
                            totalViagens: 0,
                            veiculosUtilizados: {},
                            motoristasUtilizados: {},
                            diasOperacao: new Set(),
                            operacoes: {}
                        };
                    }
                    
                    const stats = routeStatistics[rota];
                    stats.totalViagens++;
                    stats.diasOperacao.add(item.DATA);
                    
                    if (!stats.operacoes[item.OP]) {
                        stats.operacoes[item.OP] = 0;
                    }
                    stats.operacoes[item.OP]++;
                    
                    if (veiculo) {
                        if (!stats.veiculosUtilizados[veiculo]) {
                            stats.veiculosUtilizados[veiculo] = 0;
                        }
                        stats.veiculosUtilizados[veiculo]++;
                    }
                    
                    if (motorista) {
                        if (!stats.motoristasUtilizados[motorista]) {
                            stats.motoristasUtilizados[motorista] = 0;
                        }
                        stats.motoristasUtilizados[motorista]++;
                    }
                }
                
                // Estat√≠sticas por ve√≠culo
                if (veiculo) {
                    if (!vehicleStatistics[veiculo]) {
                        vehicleStatistics[veiculo] = {
                            placa: veiculo,
                            totalViagens: 0,
                            rotasFrequentes: {},
                            motoristasUtilizados: new Set(),
                            diasOperacao: new Set(),
                            operacoes: {}
                        };
                    }
                    
                    const stats = vehicleStatistics[veiculo];
                    stats.totalViagens++;
                    stats.diasOperacao.add(item.DATA);
                    stats.motoristasUtilizados.add(motorista);
                    
                    if (!stats.operacoes[item.OP]) {
                        stats.operacoes[item.OP] = 0;
                    }
                    stats.operacoes[item.OP]++;
                    
                    if (rota && rota !== 'N√£o especificada') {
                        if (!stats.rotasFrequentes[rota]) {
                            stats.rotasFrequentes[rota] = 0;
                        }
                        stats.rotasFrequentes[rota]++;
                    }
                }
            });
        }

        // CARREGAR RESUMO DOS √öLTIMOS 3 DIAS
        function loadLast3DaysSummary() {
            const daysSummary = {};
            
            const viagensComDestino = frotaData.filter(item => item.TEM_DESTINO);
            
            viagensComDestino.forEach(item => {
                if (!item.DATA) return;
                
                if (!daysSummary[item.DATA]) {
                    daysSummary[item.DATA] = {
                        date: item.DATA,
                        displayDate: item.DATA_DISPLAY,
                        total: 0,
                        operations: {},
                        vehicles: new Set(),
                        drivers: new Set()
                    };
                }
                
                const day = daysSummary[item.DATA];
                day.total++;
                day.vehicles.add(item.VEICULO);
                day.drivers.add(item.MOTORISTA);
                
                if (!day.operations[item.OP]) {
                    day.operations[item.OP] = {
                        count: 0,
                        vehicles: new Set(),
                        nome: item.OP_INFO.nome,
                        cor: item.OP_INFO.cor
                    };
                }
                day.operations[item.OP].count++;
                day.operations[item.OP].vehicles.add(item.VEICULO);
            });
            
            const last3Dates = allDates.slice(0, 3);
            
            let html = '';
            last3Dates.forEach(date => {
                const day = daysSummary[date];
                if (!day) return;
                
                const operationsList = Object.entries(day.operations)
                    .sort((a, b) => b[1].count - a[1].count)
                    .map(([op, data]) => {
                        const opClass = op;
                        const nomeCompleto = data.nome || op;
                        
                        return `
                            <div class="op-item ${opClass}">
                                <div class="op-badge ${opClass}" style="background: ${data.cor}">${op}</div>
                                <div class="op-info">
                                    <div class="op-main">
                                        <strong style="color: ${data.cor}">${data.count} viagens</strong>
                                        <span class="op-vehicles">üöõ ${data.vehicles.size} ve√≠culos</span>
                                    </div>
                                    <div style="font-size: 0.8rem; color: #666; font-weight: 600;">
                                        ${nomeCompleto}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                
                html += `
                    <div class="day-card">
                        <div class="day-header">
                            <div class="day-date">${day.displayDate}</div>
                            <div class="day-count">${day.total} viagens</div>
                        </div>
                        <div class="operations-list">
                            ${operationsList}
                        </div>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #f0f0f0; font-size: 0.9rem; color: #666;">
                            <div style="display: flex; gap: 15px;">
                                <span>üöõ ${day.vehicles.size} ve√≠culos</span>
                                <span>üë∑ ${day.drivers.size} motoristas</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            if (last3Dates.length === 0 || html === '') {
                html = `
                    <div class="day-card">
                        <div class="day-header">
                            <div class="day-date">Sem dados dispon√≠veis</div>
                            <div class="day-count">0 viagens</div>
                        </div>
                        <div style="text-align: center; padding: 30px; color: #666;">
                            Nenhuma viagem com destino v√°lido encontrada
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('last3DaysSummary').innerHTML = html;
        }

        // CARREGAR CONTROLE DI√ÅRIO DA FROTA
        function loadControleDiario() {
            const dateFilter = document.getElementById('dateFilter').value;
            let targetDate = dateFilter !== 'all' ? dateFilter : allDates[0] || '31/01/26';
            
            const viagensDoDia = frotaData.filter(item => item.DATA === targetDate && item.TEM_DESTINO);
            
            if (viagensDoDia.length === 0) {
                document.getElementById('controleDiario').innerHTML = `
                    <div class="controle-diario-header">
                        <div class="controle-diario-titulo">
                            <span>üìä</span>
                            CONTROLE DI√ÅRIO DA FROTA
                        </div>
                        <div class="controle-diario-data">${formatDateForDisplay(targetDate)}</div>
                    </div>
                    <div style="text-align: center; padding: 30px; font-size: 1.1rem; opacity: 0.9;">
                        Nenhuma viagem com destino v√°lido encontrada para este dia
                    </div>
                `;
                return;
            }
            
            const totalViagens = viagensDoDia.length;
            const veiculosSet = new Set();
            const motoristasSet = new Set();
            const operacoesCount = {};
            
            viagensDoDia.forEach(item => {
                veiculosSet.add(item.VEICULO);
                motoristasSet.add(item.MOTORISTA);
                
                if (!operacoesCount[item.OP]) {
                    operacoesCount[item.OP] = {
                        count: 0,
                        nome: item.OP_INFO.nome,
                        cor: item.OP_INFO.cor
                    };
                }
                operacoesCount[item.OP].count++;
            });
            
            const totalVeiculos = veiculosSet.size;
            const totalMotoristas = motoristasSet.size;
            
            const finalizadasCount = viagensDoDia.filter(item => 
                item.STATUS_MANUAL === 'finalizado' || item.STATUS_AUTO === 'finalizado'
            ).length;
            
            const emRotaCount = viagensDoDia.filter(item => 
                (item.STATUS_MANUAL || item.STATUS_AUTO) === 'em-rota'
            ).length;
            
            const pendentesCount = viagensDoDia.filter(item => 
                (item.STATUS_MANUAL || item.STATUS_AUTO) === 'pendente'
            ).length;
            
            const finalizadasPercent = totalViagens > 0 ? Math.round((finalizadasCount / totalViagens) * 100) : 0;
            const emRotaPercent = totalViagens > 0 ? Math.round((emRotaCount / totalViagens) * 100) : 0;
            const pendentesPercent = totalViagens > 0 ? Math.round((pendentesCount / totalViagens) * 100) : 0;
            
            const statsHtml = `
                <div class="controle-stat-item">
                    <div class="controle-stat-label">
                        <span>üöõ</span>
                        Total de Viagens
                    </div>
                    <div class="controle-stat-value">${totalViagens}</div>
                    <div class="controle-stat-sub">com destino v√°lido</div>
                </div>
                
                <div class="controle-stat-item">
                    <div class="controle-stat-label">
                        <span>üöö</span>
                        Ve√≠culos em Opera√ß√£o
                    </div>
                    <div class="controle-stat-value">${totalVeiculos}</div>
                    <div class="controle-stat-sub">diferentes</div>
                </div>
                
                <div class="controle-stat-item">
                    <div class="controle-stat-label">
                        <span>üë∑</span>
                        Motoristas Ativos
                    </div>
                    <div class="controle-stat-value">${totalMotoristas}</div>
                    <div class="controle-stat-sub">em opera√ß√£o</div>
                </div>
                
                <div class="controle-stat-item">
                    <div class="controle-stat-label">
                        <span>‚úÖ</span>
                        Status do Dia
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 5px; margin-top: 5px;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.9rem;">
                            <span>Finalizadas:</span>
                            <span style="font-weight: 700;">${finalizadasCount} (${finalizadasPercent}%)</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.9rem;">
                            <span>Em Rota:</span>
                            <span style="font-weight: 700; color: #bbdefb;">${emRotaCount} (${emRotaPercent}%)</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.9rem;">
                            <span>Pendentes:</span>
                            <span style="font-weight: 700; color: #fff9c4;">${pendentesCount} (${pendentesPercent}%)</span>
                        </div>
                    </div>
                </div>
            `;
            
            const operationsHtml = Object.entries(operacoesCount)
                .sort((a, b) => b[1].count - a[1].count)
                .map(([op, data]) => {
                    const opClass = op;
                    const cor = data.cor;
                    
                    return `
                        <div class="controle-op-item" style="border-left-color: ${cor}">
                            <div class="controle-op-badge ${opClass}" style="background: ${cor}">
                                ${op}
                            </div>
                            <div class="controle-op-info">
                                <div class="controle-op-sigla" style="color: ${cor}">
                                    ${data.nome}
                                </div>
                                <div class="controle-op-count">
                                    ${data.count} viagens
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            
            const html = `
                <div class="controle-diario-header">
                    <div class="controle-diario-titulo">
                        <span>üìä</span>
                        CONTROLE DI√ÅRIO DA FROTA
                    </div>
                    <div class="controle-diario-data">
                        ${formatDateForDisplay(targetDate)}
                    </div>
                </div>
                
                <div class="controle-diario-stats">
                    ${statsHtml}
                </div>
                
                <div style="margin-top: 20px;">
                    <div class="controle-operations-title">
                        <span>üè¢</span>
                        Opera√ß√µes do Dia
                    </div>
                    <div class="controle-operations-grid">
                        ${operationsHtml}
                    </div>
                </div>
                
                <div style="margin-top: 15px; font-size: 0.85rem; opacity: 0.8; text-align: center;">
                    Atualizado em: ${new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}
                </div>
            `;
            
            document.getElementById('controleDiario').innerHTML = html;
        }

        // ATUALIZAR RELA√á√ÉO VE√çCULOS/MOTORISTAS (ORDENADA)
        function updateRelacaoVeiculosMotoristas() {
            // Atualizar totais
            document.getElementById('totalVeiculos').textContent = veiculosData.total;
            document.getElementById('totalMotoristas').textContent = motoristasData.total;
            document.getElementById('totalVeiculosInfo').textContent = `Total: ${veiculosData.total}`;
            document.getElementById('totalMotoristasInfo').textContent = `Total: ${motoristasData.total}`;
            
            // Calcular estat√≠sticas de uso
            const veiculoUsage = {};
            const motoristaUsage = {};
            
            frotaData.forEach(item => {
                if (item.VEICULO && item.TEM_DESTINO) {
                    if (!veiculoUsage[item.VEICULO]) {
                        veiculoUsage[item.VEICULO] = 0;
                    }
                    veiculoUsage[item.VEICULO]++;
                }
                
                if (item.MOTORISTA && item.TEM_DESTINO) {
                    if (!motoristaUsage[item.MOTORISTA]) {
                        motoristaUsage[item.MOTORISTA] = 0;
                    }
                    motoristaUsage[item.MOTORISTA]++;
                }
            });
            
            // Ordenar ve√≠culos por uso (decrescente)
            const sortedVeiculos = Object.entries(veiculoUsage)
                .sort((a, b) => b[1] - a[1])
                .map(([veiculo, count]) => ({ veiculo, count }));
            
            // Ordenar motoristas por uso (decrescente)
            const sortedMotoristas = Object.entries(motoristaUsage)
                .sort((a, b) => b[1] - a[1])
                .map(([motorista, count]) => ({ motorista, count }));
            
            // Atualizar lista de ve√≠culos
            const veiculosList = document.getElementById('veiculosList');
            let veiculosHtml = '';
            
            if (sortedVeiculos.length > 0) {
                sortedVeiculos.forEach((item, index) => {
                    veiculosHtml += `
                        <div class="relacao-item">
                            <div class="relacao-nome">${item.veiculo}</div>
                            <div class="relacao-count">${item.count}</div>
                        </div>
                    `;
                });
                
                // Atualizar total se n√£o estiver definido
                if (veiculosData.total === 0) {
                    veiculosData.total = sortedVeiculos.length;
                    document.getElementById('totalVeiculos').textContent = veiculosData.total;
                    document.getElementById('totalVeiculosInfo').textContent = `Total: ${veiculosData.total}`;
                }
            } else {
                veiculosHtml = '<div style="text-align: center; padding: 20px; color: #666;">Nenhum ve√≠culo encontrado</div>';
            }
            
            veiculosList.innerHTML = veiculosHtml;
            
            // Atualizar lista de motoristas
            const motoristasList = document.getElementById('motoristasList');
            let motoristasHtml = '';
            
            if (sortedMotoristas.length > 0) {
                sortedMotoristas.forEach((item, index) => {
                    motoristasHtml += `
                        <div class="relacao-item">
                            <div class="relacao-nome">${item.motorista}</div>
                            <div class="relacao-count">${item.count}</div>
                        </div>
                    `;
                });
                
                // Atualizar total se n√£o estiver definido
                if (motoristasData.total === 0) {
                    motoristasData.total = sortedMotoristas.length;
                    document.getElementById('totalMotoristas').textContent = motoristasData.total;
                    document.getElementById('totalMotoristasInfo').textContent = `Total: ${motoristasData.total}`;
                }
            } else {
                motoristasHtml = '<div style="text-align: center; padding: 20px; color: #666;">Nenhum motorista encontrado</div>';
            }
            
            motoristasList.innerHTML = motoristasHtml;
            
            // Salvar dados atualizados
            saveVeiculosMotoristasData();
        }

        // ATUALIZAR OP√á√ïES DO FILTRO DE DATA
        function updateDateFilterOptions() {
            const select = document.getElementById('dateFilter');
            select.innerHTML = '<option value="all">Todas as Datas</option>';
            
            allDates.forEach(date => {
                const [day, month, year] = date.split('/');
                const dateObj = new Date(`20${year}`, month - 1, day);
                const displayDate = dateObj.toLocaleDateString('pt-BR', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric'
                });
                
                const count = frotaData.filter(item => item.DATA === date && item.TEM_DESTINO).length;
                
                const option = document.createElement('option');
                option.value = date;
                option.textContent = `${displayDate} (${count} viagens)`;
                select.appendChild(option);
            });
            
            // Selecionar a primeira data dispon√≠vel
            if (allDates.length > 0) {
                select.value = allDates[0];
            }
        }

        // CARREGAR DADOS DA TABELA
        function loadTableData() {
            const filteredData = getFilteredData();
            const tableBody = document.getElementById('tableBody');
            
            let html = '';
            
            filteredData.forEach((item, index) => {
                const statusFinal = item.STATUS_MANUAL || item.STATUS_AUTO;
                const isFinalizadoManualmente = item.FINALIZADO_MANUALMENTE;
                const temDestino = item.TEM_DESTINO;
                
                let rowClass = '';
                let statusClass = '';
                
                if (!temDestino) {
                    rowClass = 'sem-destino';
                    statusClass = 'status-sem-destino';
                } else {
                    rowClass = statusFinal.replace(' ', '-');
                    statusClass = `status-${statusFinal.replace(' ', '-')}`;
                }
                
                if (isFinalizadoManualmente) {
                    rowClass += ' veiculo-finalizado';
                }
                
                const destino = formatDestination(item.DESTINO || '');
                const isMultipleTrip = temDestino && item.VIAGEM_MULTIPLA;
                const opInfo = item.OP_INFO || operacoesMap[item.OP] || { nome: item.OP, cor: '#666' };
                
                let statusText = statusFinal.toUpperCase();
                if (!temDestino) {
                    statusText = 'SEM DESTINO V√ÅLIDO';
                }
                
                html += `
                    <tr class="${rowClass}" data-id="${item.id}">
                        <td style="font-weight: 700; color: ${temDestino ? '#424242' : '#9e9e9e'};">${index + 1}</td>
                        <td style="font-weight: 600; color: ${temDestino ? '#1a237e' : '#9e9e9e'};">${item.DATA}</td>
                        <td>
                            <div class="op-cell ${item.OP}" style="background: ${opInfo.cor}; opacity: ${temDestino ? '1' : '0.7'}">
                                ${item.OP}
                            </div>
                        </td>
                        <td style="font-weight: 600; color: ${temDestino ? '#1a237e' : '#9e9e9e'};">${item.VEICULO}</td>
                        <td style="font-weight: 600; color: ${temDestino ? '#1a237e' : '#9e9e9e'};">${item.MOTORISTA}</td>
                        <td>${item['PONTO_ON_MOT.'] || '-'}</td>
                        <td>${item['SA√çDA_VE√çCULO_CD'] || '-'}</td>
                        <td style="color: ${temDestino ? '#1a237e' : '#9e9e9e'};">${destino}</td>
                        <td>${item['PONTO_OFF_MOTO.'] || '-'}</td>
                        <td>
                            <span class="status-indicator ${statusClass}">
                                ${isFinalizadoManualmente ? '‚úì ' : ''}
                                ${statusText}
                            </span>
                        </td>
                        <td>
                            ${temDestino ? `
                                <button class="finalizar-btn ${isFinalizadoManualmente ? 'finalized' : ''}" 
                                        onclick="toggleFinalization('${item.id}')"
                                        ${isFinalizadoManualmente ? 'disabled' : ''}>
                                    ${isFinalizadoManualmente ? 'Finalizado' : 'Finalizar'}
                                </button>
                            ` : `
                                <button class="finalizar-btn sem-destino" disabled>
                                    Sem Destino V√°lido
                                </button>
                            `}
                        </td>
                        <td>
                            ${temDestino ? (
                                isMultipleTrip ? 
                                    `<span style="color: #ff9800; font-weight: 700;">
                                        ${item.VIAGEM_NUMERO}¬™ de ${item.TOTAL_VIAGENS}
                                        <span class="trip-badge">M√öLTIPLA</span>
                                    </span>` : 
                                    '1¬™ viagem'
                            ) : 'N/A'}
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html || `
                <tr>
                    <td colspan="12" style="text-align: center; padding: 50px; color: #666; font-size: 1.1rem;">
                        Nenhuma viagem encontrada com os filtros atuais
                    </td>
                </tr>
            `;
            
            const viagensComDestinoCount = filteredData.filter(item => item.TEM_DESTINO).length;
            const totalViagensCount = filteredData.length;
            const destinoFilter = document.getElementById('destinoFilter').value;
            
            if (destinoFilter === 'com-destino') {
                document.getElementById('tripCount').textContent = `(${viagensComDestinoCount} viagens com destino v√°lido)`;
            } else if (destinoFilter === 'sem-destino') {
                document.getElementById('tripCount').textContent = `(${totalViagensCount - viagensComDestinoCount} viagens sem destino v√°lido)`;
            } else {
                document.getElementById('tripCount').textContent = `(${totalViagensCount} viagens total)`;
            }
        }

        // FORMATAR DESTINO
        function formatDestination(destino) {
            if (!destino || destino.trim() === '') return '<span style="color: #9e9e9e; font-style: italic;">Sem destino</span>';
            
            const destinoUpper = destino.toUpperCase();
            if (destinoUpper.includes('COBRAN√áA') || 
                destinoUpper.includes('COBRANCA') ||
                destinoUpper.startsWith('GARAGEM X') ||
                destinoUpper.includes(' X GARAGEM') ||
                destinoUpper.includes('RETORNOU CARREGADO') ||
                destinoUpper.includes('SEM CONDI√á√ïES') ||
                destinoUpper.includes('N√ÉO SAIU') ||
                destinoUpper.includes('VE√çCULO N√ÉO') ||
                destinoUpper.includes('TRANSBORDO')) {
                return `<span style="color: #9e9e9e; font-style: italic;">${destino.substring(0, 50)}${destino.length > 50 ? '...' : ''} (inv√°lido)</span>`;
            }
            
            const lojaMatch = destino.match(/(\d+)/);
            if (lojaMatch) {
                const lojaNum = lojaMatch[0];
                const nomePart = destino.split('-').slice(1).join('-').trim() || destino.split(' ').slice(1).join(' ').trim();
                const nome = nomePart.substring(0, 25);
                return `<span title="${destino}">${lojaNum} - ${nome}${nomePart.length > 25 ? '...' : ''}</span>`;
            }
            
            return destino.substring(0, 30) + (destino.length > 30 ? '...' : '');
        }

        // OBTER DADOS FILTRADOS
        function getFilteredData() {
            let filtered = [...frotaData];
            
            const dateFilter = document.getElementById('dateFilter').value;
            if (dateFilter !== 'all') {
                filtered = filtered.filter(item => item.DATA === dateFilter);
            }
            
            const opFilter = document.getElementById('opFilter').value;
            if (opFilter !== 'all') {
                filtered = filtered.filter(item => item.OP === opFilter);
            }
            
            const statusFilter = document.getElementById('statusFilter').value;
            if (statusFilter !== 'all') {
                filtered = filtered.filter(item => {
                    if (statusFilter === 'com-destino') {
                        return item.TEM_DESTINO;
                    } else if (statusFilter === 'sem-destino') {
                        return !item.TEM_DESTINO;
                    } else {
                        const status = item.STATUS_MANUAL || item.STATUS_AUTO;
                        return status === statusFilter;
                    }
                });
            }
            
            const destinoFilter = document.getElementById('destinoFilter').value;
            if (destinoFilter === 'com-destino') {
                filtered = filtered.filter(item => item.TEM_DESTINO);
            } else if (destinoFilter === 'sem-destino') {
                filtered = filtered.filter(item => !item.TEM_DESTINO);
            }
            
            return filtered;
        }

        // FILTRAR TABELA
        function filterTable() {
            loadTableData();
            loadControleDiario();
            calculateAdvancedStatistics();
            updateRotaFrequente();
            updateRelacaoVeiculosMotoristas();
        }

        // CARREGAR DATA ESPEC√çFICA
        function loadDate(type) {
            let targetDate = '';
            let displayText = '';
            
            switch(type) {
                case 'today':
                    const today = new Date();
                    const todayFormatted = `${today.getDate().toString().padStart(2, '0')}/${(today.getMonth() + 1).toString().padStart(2, '0')}/${today.getFullYear().toString().slice(2)}`;
                    targetDate = todayFormatted;
                    displayText = today.toLocaleDateString('pt-BR', { 
                        weekday: 'long', 
                        day: 'numeric', 
                        month: 'long', 
                        year: 'numeric' 
                    });
                    break;
                case 'yesterday':
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    const yesterdayFormatted = `${yesterday.getDate().toString().padStart(2, '0')}/${(yesterday.getMonth() + 1).toString().padStart(2, '0')}/${yesterday.getFullYear().toString().slice(2)}`;
                    targetDate = yesterdayFormatted;
                    displayText = yesterday.toLocaleDateString('pt-BR', { 
                        weekday: 'long', 
                        day: 'numeric', 
                        month: 'long', 
                        year: 'numeric' 
                    });
                    break;
                case 'all':
                    targetDate = 'all';
                    displayText = 'Todas as Datas';
                    break;
            }
            
            document.querySelectorAll('.date-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            document.getElementById('currentDateDisplay').textContent = displayText;
            document.getElementById('dateFilter').value = targetDate;
            
            filterTable();
        }

        // TOGGLE FINALIZA√á√ÉO MANUAL
        function toggleFinalization(id) {
            const item = frotaData.find(item => item.id === id);
            if (!item) return;
            
            if (!item.TEM_DESTINO) {
                showNotification('N√£o √© poss√≠vel finalizar uma viagem sem destino v√°lido', 'error');
                return;
            }
            
            if (manualFinalizations[id]) {
                delete manualFinalizations[id];
                item.STATUS_MANUAL = null;
                item.FINALIZADO_MANUALMENTE = false;
            } else {
                manualFinalizations[id] = {
                    timestamp: new Date().toISOString(),
                    autoStatus: item.STATUS_AUTO
                };
                item.STATUS_MANUAL = 'finalizado';
                item.FINALIZADO_MANUALMENTE = true;
            }
            
            saveManualFinalizations();
            
            // ATUALIZAR TUDO
            filterTable();
            loadControleDiario();
            calculateAdvancedStatistics();
            updateRotaFrequente();
            
            showNotification(
                item.FINALIZADO_MANUALMENTE ? 
                `Viagem finalizada manualmente` :
                `Finaliza√ß√£o manual removida`,
                item.FINALIZADO_MANUALMENTE ? 'success' : 'info'
            );
        }

        // ATUALIZAR ROTAS FREQUENTES
        function updateRotaFrequente() {
            const routes = Object.values(routeStatistics)
                .sort((a, b) => b.totalViagens - a.totalViagens)
                .slice(0, 10);
            
            let html = '';
            
            routes.forEach(route => {
                const nomeExibicao = route.nome.length > 40 ? route.nome.substring(0, 40) + '...' : route.nome;
                const diasOperacao = route.diasOperacao.size;
                const veiculoMaisUtilizado = Object.keys(route.veiculosUtilizados).reduce((a, b) => 
                    route.veiculosUtilizados[a] > route.veiculosUtilizados[b] ? a : b, 'N√£o definido'
                );
                const motoristaMaisFrequente = Object.keys(route.motoristasUtilizados).reduce((a, b) => 
                    route.motoristasUtilizados[a] > route.motoristasUtilizados[b] ? a : b, 'N√£o definido'
                );
                
                const opMaisFrequente = Object.keys(route.operacoes).reduce((a, b) => 
                    route.operacoes[a] > route.operacoes[b] ? a : b, 'N√£o definida'
                );
                const opInfo = operacoesMap[opMaisFrequente] || { nome: opMaisFrequente, cor: '#666' };
                
                html += `
                    <div class="rota-card">
                        <div class="rota-header">
                            <div class="rota-titulo">${nomeExibicao}</div>
                            <div style="background: ${opInfo.cor}; color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.9rem; font-weight: 700;">
                                ${route.totalViagens} viagens
                            </div>
                        </div>
                        
                        <div class="rota-metricas">
                            <div>
                                <span style="color: #666; font-size: 0.85rem;">Dias de opera√ß√£o:</span>
                                <div style="font-weight: 700; color: #1a237e;">${diasOperacao}</div>
                            </div>
                            <div>
                                <span style="color: #666; font-size: 0.85rem;">Opera√ß√£o principal:</span>
                                <div style="display: flex; align-items: center; gap: 5px; margin-top: 2px;">
                                    <div class="op-cell ${opMaisFrequente}" style="background: ${opInfo.cor}; font-size: 0.8rem; padding: 2px 8px;">
                                        ${opMaisFrequente}
                                    </div>
                                    <span style="font-size: 0.85rem; color: #666;">${opInfo.nome}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="rota-veiculos">
                            <div style="display: flex; gap: 20px; font-size: 0.85rem;">
                                <div>
                                    <span style="color: #666;">Ve√≠culo mais usado:</span>
                                    <div class="veiculo-frequente">${veiculoMaisUtilizado}</div>
                                </div>
                                <div>
                                    <span style="color: #666;">Motorista frequente:</span>
                                    <div style="color: #1a237e; font-weight: 600;">${motoristaMaisFrequente}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            if (routes.length === 0) {
                html = '<div style="text-align: center; padding: 30px; color: #666;">Nenhuma rota com destino v√°lido encontrada</div>';
            }
            
            document.getElementById('rotaFrequenteContent').innerHTML = html;
        }

        // ============================================
        // FUN√á√ïES DE CONTROLE E MODAIS
        // ============================================

        // ABRIR MODAL DE ATUALIZA√á√ÉO DE VE√çCULOS
        function openUpdateVeiculosModal() {
            document.getElementById('veiculosInput').value = veiculosData.total;
            document.getElementById('veiculosLS').value = veiculosData.distribuicao.LS;
            document.getElementById('veiculosHT').value = veiculosData.distribuicao.HT;
            document.getElementById('veiculosTL').value = veiculosData.distribuicao.TL;
            document.getElementById('veiculosCV').value = veiculosData.distribuicao.CV;
            document.getElementById('veiculosNL').value = veiculosData.distribuicao.NL;
            document.getElementById('updateVeiculosModal').style.display = 'flex';
        }

        // FECHAR MODAL DE ATUALIZA√á√ÉO DE VE√çCULOS
        function closeUpdateVeiculosModal() {
            document.getElementById('updateVeiculosModal').style.display = 'none';
        }

        // ATUALIZAR DADOS DE VE√çCULOS
        function updateVeiculos() {
            const total = parseInt(document.getElementById('veiculosInput').value) || 0;
            const ls = parseInt(document.getElementById('veiculosLS').value) || 0;
            const ht = parseInt(document.getElementById('veiculosHT').value) || 0;
            const tl = parseInt(document.getElementById('veiculosTL').value) || 0;
            const cv = parseInt(document.getElementById('veiculosCV').value) || 0;
            const nl = parseInt(document.getElementById('veiculosNL').value) || 0;
            
            // Validar se a soma das distribui√ß√µes n√£o excede o total
            const somaDistribuicao = ls + ht + tl + cv + nl;
            if (somaDistribuicao > total) {
                showNotification('A soma das distribui√ß√µes por opera√ß√£o n√£o pode ser maior que o total de ve√≠culos!', 'error');
                return;
            }
            
            veiculosData = {
                total: total,
                distribuicao: {
                    LS: ls,
                    HT: ht,
                    TL: tl,
                    CV: cv,
                    NL: nl
                }
            };
            
            saveVeiculosMotoristasData();
            updateRelacaoVeiculosMotoristas();
            closeUpdateVeiculosModal();
            
            showNotification(`Total de ve√≠culos atualizado para ${total}`, 'success');
        }

        // ABRIR MODAL DE ATUALIZA√á√ÉO DE MOTORISTAS
        function openUpdateMotoristasModal() {
            document.getElementById('motoristasInput').value = motoristasData.total;
            document.getElementById('motoristasListInput').value = motoristasData.lista.join('\n');
            document.getElementById('updateMotoristasModal').style.display = 'flex';
        }

        // FECHAR MODAL DE ATUALIZA√á√ÉO DE MOTORISTAS
        function closeUpdateMotoristasModal() {
            document.getElementById('updateMotoristasModal').style.display = 'none';
        }

        // ATUALIZAR DADOS DE MOTORISTAS
        function updateMotoristas() {
            const total = parseInt(document.getElementById('motoristasInput').value) || 0;
            const listaTexto = document.getElementById('motoristasListInput').value;
            
            // Processar lista de motoristas
            const novaLista = listaTexto.split('\n')
                .map(nome => nome.trim())
                .filter(nome => nome.length > 0);
            
            // Combinar com lista existente, removendo duplicatas
            const listaCombinada = [...new Set([...motoristasData.lista, ...novaLista])];
            
            // Se o total for maior que 0, ajustar a lista
            let listaFinal = listaCombinada;
            if (total > 0 && listaCombinada.length < total) {
                // Adicionar motoristas gen√©ricos se necess√°rio
                for (let i = listaCombinada.length; i < total; i++) {
                    listaFinal.push(`Motorista ${i + 1}`);
                }
            } else if (total > 0 && listaCombinada.length > total) {
                // Limitar ao total informado
                listaFinal = listaCombinada.slice(0, total);
            }
            
            motoristasData = {
                total: total,
                lista: listaFinal
            };
            
            saveVeiculosMotoristasData();
            updateRelacaoVeiculosMotoristas();
            closeUpdateMotoristasModal();
            
            showNotification(`Total de motoristas atualizado para ${total}`, 'success');
        }

        // SOLICITAR SENHA PARA IMPORTAR DADOS
        function requestPassword() {
            document.getElementById('passwordInput').value = '';
            document.getElementById('passwordError').style.display = 'none';
            document.getElementById('passwordModal').style.display = 'flex';
        }

        // FECHAR MODAL DE SENHA
        function closePasswordModal() {
            document.getElementById('passwordModal').style.display = 'none';
        }

        // VERIFICAR SENHA
        function verifyPassword() {
            const password = document.getElementById('passwordInput').value;
            
            if (password === SUPERVISOR_PASSWORD) {
                closePasswordModal();
                document.getElementById('fileInput').click();
            } else {
                document.getElementById('passwordError').style.display = 'block';
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }

        // HANDLE FILE UPLOAD
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.name.toLowerCase().endsWith('.csv')) {
                alert('Por favor, selecione um arquivo CSV!');
                return;
            }
            
            showLoading();
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const csvData = e.target.result;
                    
                    if (!csvData || csvData.trim().length === 0) {
                        throw new Error('Arquivo CSV vazio');
                    }
                    
                    // Processar os dados
                    processCSVData(csvData);
                    
                    showNotification(
                        `Dados atualizados com sucesso! ${frotaData.length} registros carregados (${frotaData.filter(item => item.TEM_DESTINO).length} com destino v√°lido).`,
                        'success'
                    );
                    
                } catch (error) {
                    console.error('Erro ao processar arquivo:', error);
                    showNotification(`Erro ao processar arquivo: ${error.message}`, 'error');
                } finally {
                    hideLoading();
                }
            };
            
            reader.onerror = function() {
                alert('Erro ao ler o arquivo');
                hideLoading();
            };
            
            reader.readAsText(file, 'UTF-8');
        }

        // CONFIRMAR LIMPEZA DE DADOS
        function confirmClearData() {
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Esta a√ß√£o ir√° REMOVER TODOS os dados do sistema!\n\nIsso inclui:\n‚Ä¢ Todos os registros de viagens\n‚Ä¢ Finaliza√ß√µes manuais\n‚Ä¢ Estat√≠sticas\n‚Ä¢ Dados de ve√≠culos e motoristas\n\nVoc√™ poder√° importar um novo arquivo CSV ap√≥s a limpeza.\n\nTem certeza que deseja continuar?')) {
                clearAllData();
            }
        }

        // LIMPAR TODOS OS DADOS
        function clearAllData() {
            showLoading();
            
            try {
                // Limpar arrays
                frotaData = [];
                manualFinalizations = {};
                allDates = [];
                driverStatistics = {};
                routeStatistics = {};
                vehicleStatistics = {};
                
                // Limpar dados de ve√≠culos e motoristas
                veiculosData = {
                    total: 0,
                    distribuicao: {
                        LS: 0,
                        HT: 0,
                        TL: 0,
                        CV: 0,
                        NL: 0
                    }
                };
                
                motoristasData = {
                    total: 0,
                    lista: []
                };
                
                // Limpar localStorage
                localStorage.removeItem('frotaCSVData');
                localStorage.removeItem('frotaManualFinalizations');
                localStorage.removeItem('frotaVeiculosData');
                localStorage.removeItem('frotaMotoristasData');
                
                // Resetar para dados iniciais vazios
                processCSVData('DATA,DIA,OP,VEICULO,MOTORISTA,PONTO_ON_MOT.,PREVIS√ÉO_REFEI√á√ÉO,PONTO_OFF_MOTO.,PR√ìX_HORA_DISP,DESTINO,SA√çDA_VE√çCULO_CD');
                
                showNotification('‚úÖ Todos os dados foram removidos com sucesso! Agora voc√™ pode importar um novo arquivo CSV.', 'success');
            } catch (error) {
                console.error('Erro ao limpar dados:', error);
                showNotification('Erro ao limpar dados: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }

        // ABRIR MODAL DE EXPORTA√á√ÉO
        function openExportModal() {
            if (Object.keys(routeStatistics).length === 0) {
                showNotification('Nenhuma rota encontrada para exportar.', 'error');
                return;
            }
            
            const excelData = generateExcelExportData();
            const jsonData = generateJsonExportData();
            
            document.getElementById('exportExcelData').value = excelData;
            document.getElementById('exportJsonData').value = jsonData;
            
            document.getElementById('exportModal').style.display = 'flex';
        }

        // FECHAR MODAL DE EXPORTA√á√ÉO
        function closeExportModal() {
            document.getElementById('exportModal').style.display = 'none';
        }

        // GERAR DADOS PARA EXPORTA√á√ÉO EM FORMATO CSV
        function generateExcelExportData() {
            const routes = Object.values(routeStatistics)
                .sort((a, b) => b.totalViagens - a.totalViagens);
            
            let csvData = "Rota,Total Viagens,Dias Opera√ß√£o,Ve√≠culo Mais Usado,Ve√≠culo Uso Count,Motorista Mais Frequente,Opera√ß√£o Principal\n";
            
            routes.forEach(route => {
                const rota = route.nome.replace(/,/g, ';');
                const totalViagens = route.totalViagens;
                const diasOperacao = route.diasOperacao.size;
                const veiculoMaisUtilizado = Object.keys(route.veiculosUtilizados).reduce((a, b) => 
                    route.veiculosUtilizados[a] > route.veiculosUtilizados[b] ? a : b, 'N/A'
                );
                const veiculoUsoCount = route.veiculosUtilizados[veiculoMaisUtilizado] || 0;
                const motoristaMaisFrequente = Object.keys(route.motoristasUtilizados).reduce((a, b) => 
                    route.motoristasUtilizados[a] > route.motoristasUtilizados[b] ? a : b, 'N/A'
                );
                const operacaoPrincipal = Object.keys(route.operacoes).reduce((a, b) => 
                    route.operacoes[a] > route.operacoes[b] ? a : b, 'N/A'
                );
                
                csvData += `"${rota}",${totalViagens},${diasOperacao},"${veiculoMaisUtilizado}",${veiculoUsoCount},"${motoristaMaisFrequente}","${operacaoPrincipal}"\n`;
            });
            
            const exportDate = new Date().toLocaleString('pt-BR');
            const totalRotas = routes.length;
            const totalViagensTotal = routes.reduce((sum, route) => sum + route.totalViagens, 0);
            
            csvData += `\n\nMETADADOS DA EXPORTA√á√ÉO\n`;
            csvData += `Data da exporta√ß√£o:,${exportDate}\n`;
            csvData += `Total de rotas √∫nicas:,${totalRotas}\n`;
            csvData += `Total de viagens:,${totalViagensTotal}\n`;
            csvData += `Filtro aplicado:,Apenas viagens com destino v√°lido\n`;
            csvData += `Sistema:,Controle de Frota - Dashboard Completo\n`;
            
            return csvData;
        }

        // GERAR DADOS JSON PARA EXPORTA√á√ÉO
        function generateJsonExportData() {
            const routes = Object.values(routeStatistics)
                .sort((a, b) => b.totalViagens - a.totalViagens)
                .map(route => ({
                    rota: route.nome,
                    totalViagens: route.totalViagens,
                    diasOperacao: Array.from(route.diasOperacao),
                    veiculoMaisUtilizado: Object.keys(route.veiculosUtilizados).reduce((a, b) => 
                        route.veiculosUtilizados[a] > route.veiculosUtilizados[b] ? a : b, 'N/A'
                    ),
                    veiculoUsoCount: route.veiculosUtilizados[Object.keys(route.veiculosUtilizados).reduce((a, b) => 
                        route.veiculosUtilizados[a] > route.veiculosUtilizados[b] ? a : b, 'N/A'
                    )] || 0,
                    motoristaMaisFrequente: Object.keys(route.motoristasUtilizados).reduce((a, b) => 
                        route.motoristasUtilizados[a] > route.motoristasUtilizados[b] ? a : b, 'N/A'
                    ),
                    operacaoPrincipal: Object.keys(route.operacoes).reduce((a, b) => 
                        route.operacoes[a] > route.operacoes[b] ? a : b, 'N/A'
                    ),
                    operacoesDetalhadas: route.operacoes,
                    veiculosUtilizados: route.veiculosUtilizados,
                    motoristasUtilizados: route.motoristasUtilizados
                }));
            
            const exportData = {
                metadata: {
                    exportDate: new Date().toISOString(),
                    exportDateDisplay: new Date().toLocaleString('pt-BR'),
                    totalRotas: routes.length,
                    totalViagens: routes.reduce((sum, route) => sum + route.totalViagens, 0),
                    filtroAplicado: 'Apenas viagens com destino v√°lido',
                    sistema: 'Controle de Frota - Dashboard Completo'
                },
                rotas: routes
            };
            
            return JSON.stringify(exportData, null, 2);
        }

        // COPIAR DADOS PARA EXCEL
        function copyExcelData() {
            const textarea = document.getElementById('exportExcelData');
            textarea.select();
            textarea.setSelectionRange(0, 99999);
            
            try {
                document.execCommand('copy');
                showNotification('Dados copiados para a √°rea de transfer√™ncia! Cole na c√©lula A1 do Excel ou Google Sheets.', 'success');
            } catch (err) {
                showNotification('Erro ao copiar dados. Use Ctrl+C manualmente.', 'error');
            }
        }

        // COPIAR DADOS JSON
        function copyJsonData() {
            const textarea = document.getElementById('exportJsonData');
            textarea.select();
            textarea.setSelectionRange(0, 99999);
            
            try {
                document.execCommand('copy');
                showNotification('Dados JSON copiados para a √°rea de transfer√™ncia!', 'success');
            } catch (err) {
                showNotification('Erro ao copiar dados. Use Ctrl+C manualmente.', 'error');
            }
        }

        // COPIAR ROTAS PARA PLANILHA
        function copyRoutesToClipboard() {
            const routes = Object.values(routeStatistics)
                .sort((a, b) => b.totalViagens - a.totalViagens)
                .slice(0, 20);
            
            if (routes.length === 0) {
                showNotification('Nenhuma rota encontrada para copiar.', 'error');
                return;
            }
            
            let clipboardData = "ROTA\tTOTAL VIAGENS\tDIAS OPERA√á√ÉO\tVE√çCULO MAIS USADO\tMOTORISTA FREQUENTE\tOPERA√á√ÉO PRINCIPAL\n";
            
            routes.forEach(route => {
                const veiculoMaisUtilizado = Object.keys(route.veiculosUtilizados).reduce((a, b) => 
                    route.veiculosUtilizados[a] > route.veiculosUtilizados[b] ? a : b, 'N/A'
                );
                const motoristaMaisFrequente = Object.keys(route.motoristasUtilizados).reduce((a, b) => 
                    route.motoristasUtilizados[a] > route.motoristasUtilizados[b] ? a : b, 'N/A'
                );
                const operacaoPrincipal = Object.keys(route.operacoes).reduce((a, b) => 
                    route.operacoes[a] > route.operacoes[b] ? a : b, 'N/A'
                );
                
                clipboardData += `${route.nome}\t${route.totalViagens}\t${route.diasOperacao.size}\t${veiculoMaisUtilizado}\t${motoristaMaisFrequente}\t${operacaoPrincipal}\n`;
            });
            
            clipboardData += `\nExportado em: ${new Date().toLocaleString('pt-BR')}\n`;
            clipboardData += `Total de rotas: ${routes.length}\n`;
            clipboardData += `Apenas viagens com destino v√°lido`;
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(clipboardData)
                    .then(() => {
                        showNotification('Dados copiados para a √°rea de transfer√™ncia! Cole em qualquer planilha.', 'success');
                    })
                    .catch(err => {
                        fallbackCopyTextToClipboard(clipboardData);
                    });
            } else {
                fallbackCopyTextToClipboard(clipboardData);
            }
        }

        // FALLBACK PARA COPIAR TEXTO
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.left = "-999999px";
            textArea.style.top = "-999999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showNotification('Dados copiados para a √°rea de transfer√™ncia! Cole em qualquer planilha.', 'success');
            } catch (err) {
                showNotification('Erro ao copiar dados. Tente manualmente com Ctrl+C.', 'error');
            }
            
            document.body.removeChild(textArea);
        }

        // MOSTRAR NOTIFICA√á√ÉO
        function showNotification(message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${message}`);
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#4caf50' : type === 'error' ? '#f44336' : '#2196f3'};
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                font-weight: 600;
                box-shadow: 0 4px 20px rgba(0,0,0,0.2);
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // ATUALIZAR CONTADORES
        function updateCounters() {
            const totalRegistros = frotaData.length;
            const viagensComDestino = frotaData.filter(item => item.TEM_DESTINO).length;
            
            document.getElementById('totalRecords').textContent = totalRegistros;
            document.getElementById('totalViagensComDestino').textContent = viagensComDestino;
        }

        // ATUALIZAR TIMESTAMP
        function updateTimestamp() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('pt-BR', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
            const dateStr = now.toLocaleDateString('pt-BR', {
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });
            
            document.getElementById('lastUpdate').textContent = `${dateStr} √†s ${timeStr}`;
        }

        // MOSTRAR LOADING
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        // ESCONDER LOADING
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // Adicionar eventos para upload box (garantir funcionamento)
        document.addEventListener('DOMContentLoaded', function() {
            // Garantir que o upload box funcione
            const uploadBox = document.querySelector('.upload-box');
            
            if (uploadBox) {
                uploadBox.addEventListener('click', function() {
                    requestPassword();
                });
            }
            
            console.log('Dashboard totalmente carregado e funcional!');
        });

    </script>
</body>
</html>
